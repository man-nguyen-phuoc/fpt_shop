<div class="cart_body">
  <div class="row px-md-4">
    <div class="col-lg-8">
      <p class="pb-2 fw-bold">List Products</p>
      <div class="card">
        <div class="ribbon ribbon-top-right"><span>SALE TIME!</span></div>
          <div>
            <div class="table-responsive px-md-4 px-2 pt-3">
              <table class="table table-borderless">
                <tbody>
                  <%- order_detail_item = @show_facade.order_detail_items.first %>
                  <%- itemable = order_detail_item.itemable %>
                  <%= form_with url: order_detail_path(@order_detail), method: :put do |f| %>
                    <%= f.hidden_field :order_detail_item_id, value: order_detail_item.id %>
                    <tr class="border-bottom order-item">
                      <td>
                        <div class="d-flex align-items-center">
                          <div><%= image_tag itemable.thumbnail, size: "100"%></div>
                          <div class="ps-3 d-flex flex-column justify-content">
                            <p class="fw-bold">Air<span class="ps-1"><%= itemable.name%></span></p>
                            <small class=" d-flex"> <span class=" text-muted">Color:</span> <span class=" fw-bold">Red/White</span> </small>
                            <small class=""> <span class=" text-muted">Size:</span> <span class=" fw-bold">L</span> </small>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="d-flex">
                          <p class="pe-3"><span class="red"><%= currency_to_number(itemable.price - itemable.price * itemable.discount/100)%></span></p>
                          <p class="text-muted text-decoration-line-through"><%= currency_to_number(itemable.price) %></p>
                        </div>
                      </td>
                      <td>
                        <div class="d-flex">
                          <div class="pe-3 text-muted">Quantity</div>
                          <div class="pe-3">
                          <%= f.number_field :quantity, value: order_detail_item.quantity %>
                          </div>
                          <div class="pe-3">
                            <%= f.submit %>
                          </div>
                        </div>
                      </td>
                    </tr>
                  <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4 payment-summary">
      <p class="fw-bold pt-lg-0 pt-4 pb-2">Payment Summary</p>
      <div class="card px-md-3 px-2 pt-4">
        <div class="unregistered mb-4">
          <% if current_user.shipping_address == nil%>
            <div class="unregistered mb-4">
              <span class="py-1">unregistered shipping address</span>
              <%= link_to edit_user_path(current_user), method: :get do %>
              registered
              <% end%>
            </div>
          <%end%>
        </div>
        <div class="d-flex justify-content-between pb-3"> <small class="text-muted">Transaction code</small>
          <p class="">VC115665</p>
        </div>
        <%= form_tag order_detail_path(@order_detail), method: :put do %>
          <%= hidden_field_tag :order_detail_item_id, @order_detail.order_detail_items.first.id%>
          <div class="">
            <% if @show_facade.coupon %>
              <%= text_field_tag :coupon_code, @show_facade.coupon.code%>
            <% else %>
              <%= text_field_tag :coupon_code %>
            <% end %>
          </div>
          <div class='d-flex justify-content-between pt-2'>
            <%= submit_tag "Checking", class: 'coupon-md'%>
            <!-- trigger modal -->
            <a type="button" class="coupon-md" data-bs-toggle="modal" data-bs-target="#exampleModal">
              Coupons
            </a>
          </div>
        <% end %>
        <%= form_tag orders_path(order_detail_id: @order_detail.id), method: :post do%>
          <div class="d-flex flex-column">
            <div class="d-flex justify-content-between pt-3"> <small class="text-muted">Order Summary:</small>
              <p>
                <%= currency_to_number(order_summary(order_detail_item, order_detail_item.quantity))%>
              </p>
            </div>
            <div class="d-flex justify-content-between"> <small class="text-muted">Shipping fee:</small>
              <p>
                <%= currency_to_number(20_000)%>
              </p>
            </div>
            <div class="d-flex justify-content-between b-bottom pb-1"> <small class="text-muted">Discount:</small>
              <p>
                <%= currency_to_number(@show_facade.coupon&.price)%>
              </p>
            </div>
            <div class="d-flex justify-content-between pt-3 pb-3"> <small class="text-muted">Total Amount:</small>
              <h5 class='strike-md-code'>
                <%= currency_to_number(order_summary_coupon(order_detail_item, @show_facade.coupon) + 20_000)%>
              </h5>
            </div>
            <%= submit_tag "Order", class: "btn btn-primary order-cart"%>
          </div>
        <% end %>
      </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Coupons</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <%- @show_facade.all_coupons.each do |coupon| %>
              <%= form_with url: order_detail_path(@order_detail), method: :put do |form|%>
                <%= form.hidden_field :coupon_id, value: coupon.id %>
                <%= form.hidden_field :order_detail_item_id, value: order_detail_item.id %>
                <div class="row p-2 border rounded coupon-md-item mb-1">
                  <div class="col-md-8 mt-1">
                    <div class='d-flex'>
                      <h6>CODE:</h6>
                      <h6 class='strike-md-code'><%= coupon.code %></h6>
                    </div>
                    <div class="d-flex">
                      <span class='strike-text'>Discount: </span>
                      <b class="mr-1 strike-md-number"><%= currency_to_number(coupon.price)%></b>
                    </div>
                  </div>
                  <div class="align-items-center align-content-center col-md-4 border-left mt-1">
                    <div class="d-flex flex-column mt-4">
                      <%= form.submit 'Use', class: 'btn btn-primary btn-sm mt-2'%>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>